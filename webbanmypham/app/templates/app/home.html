{% extends 'app/base.html' %} 
{% load static %}
{% load price_filters %}

{% block title %}Trang Chủ - Beauty Shop{% endblock %}

{% block content %}
<div id="slide">
  <div class="slide-container">
    <div class="slide-wrapper">
      <div class="slide-item">
        <img src="https://i.pinimg.com/1200x/e0/17/28/e017286eabf082b5d62f8bcdbe9a426b.jpg" alt="Slide 1" />
        <div class="slide-caption">
          <h2>Chăm sóc da mặt</h2>
          <p>Bật sắc xinh, chinh phục cá tính</p>
        </div>
      </div>
      <div class="slide-item">
        <img src="https://i.pinimg.com/1200x/e0/17/28/e017286eabf082b5d62f8bcdbe9a426b.jpg" alt="Slide 2" />
        <div class="slide-caption">
          <h2>Trang điểm</h2>
          <p>Biến hoá đa sắc màu</p>
        </div>
      </div>
      <div class="slide-item">
        <img src="https://i.pinimg.com/1200x/9f/b1/18/9fb118d3d637cf3ac9bba3343ac52e69.jpg" alt="Slide 3" />
        <div class="slide-caption">
          <h2>Phụ kiện làm đẹp</h2>
          <p>"Hack" nhan sắc, tự tin "Level Max"</p>
        </div>
      </div>
      <div class="slide-item">
        <img src="https://i.pinimg.com/1200x/f0/ee/f3/f0eef3a42c6f9e85a3ea25eab01d297b.jpg" alt="Slide 4" />
        <div class="slide-caption">
          <h2>Chăm sóc cơ thể</h2>
          <p>Khiến mọi người phải "GATO", Chinh phục xu hướng mới</p>
        </div>
      </div>
      <div class="slide-item">
        <img src="https://i.pinimg.com/1200x/eb/79/46/eb794603f0cd90fb31f80dbd70cb4074.jpg" alt="Slide 5" />
        <div class="slide-caption">
          <h2>Phụ kiện làm đẹp</h2>
          <p>Khui chất riêng-Bung màu cá tính</p>
        </div>
      </div>
    </div>

    <button class="nav-button prev-button" onclick="prevSlide()">&#10094;</button>
    <button class="nav-button next-button" onclick="nextSlide()">&#10095;</button>

    <div class="slide-indicators">
      <span class="indicator-dot active" onclick="goToSlide(0)"></span>
      <span class="indicator-dot" onclick="goToSlide(1)"></span>
      <span class="indicator-dot" onclick="goToSlide(2)"></span>
      <span class="indicator-dot" onclick="goToSlide(3)"></span>
      <span class="indicator-dot" onclick="goToSlide(4)"></span>
    </div>
  </div>
</div>

<section id="main">
  <section id="content">
    
    <section id="top-offers">
      <div class="container">
        <div class="section-header">
          <h2>Gợi ý dành cho bạn</h2>
          <div class="header-icons">
            <button class="home-icon"><i class="fas fa-home"></i></button>
          </div>
        </div>

        <div class="offers-carousel">
          <button class="arrow prev" onclick="scrollCarousel('offer_list', -1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="arrow next" onclick="scrollCarousel('offer_list', 1)">
            <i class="fas fa-chevron-right"></i>
          </button>

          <div class="carousel-container" id="offer_list">
            {% for product in offer_products %}
            <div class="product-card">
              <div class="product-card__image">
                <a href="{% url 'product_detail' product.id %}">
                  <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/190x243{% endif %}"
                       alt="{{ product.name }}" loading="lazy" />
                </a>
                {% if product.active_deal %}
                <span class="product-card__badge deal">-{{ product.active_deal.discount_percent }}%</span>
                {% elif product.sale_price > 0 %}
                <span class="product-card__badge sale">Sale</span>
                {% endif %}
                <div class="product-card__overlay">
                  <div class="product-card__actions">
                    <button onclick="toggleWishlist(event, {{ product.id }})" class="action-btn {% if product.id in wishlist_product_ids %}wishlisted{% endif %}" title="Yêu thích">
                      <i class="{% if product.id in wishlist_product_ids %}fas{% else %}far{% endif %} fa-heart"></i>
                    </button>
                    <a href="{% url 'product_detail' product.id %}" class="action-btn" title="Xem chi tiết">
                      <i class="far fa-eye"></i>
                    </a>
                    <button onclick="addToCartAjax(event, {{ product.id }})" class="action-btn" title="Thêm vào giỏ">
                      <i class="fas fa-shopping-basket"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="product-card__info">
                <span class="product-card__category">{{ product.category.name }}</span>
                <h3 class="product-card__name"><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></h3>
                <div class="product-card__rating">
                  <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                  <span>({{ product.review_set.count|default:0 }})</span>
                </div>
                <div class="product-card__price">
                  {% if product.active_deal %}
                  <span class="price-current deal">{{ product.active_deal.deal_price|vnd }}</span>
                  <span class="price-original">{{ product.price|vnd }}</span>
                  {% elif product.sale_price > 0 %}
                  <span class="price-current">{{ product.sale_price|vnd }}</span>
                  <span class="price-original">{{ product.price|vnd }}</span>
                  {% else %}
                  <span class="price-current">{{ product.price|vnd }}</span>
                  {% endif %}
                </div>
                <button onclick="addToCartAjax(event, {{ product.id }})" class="product-card__add-btn">
                  <i class="fas fa-cart-plus"></i> Thêm vào giỏ
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <section id="weekend-deals">
      <div class="deal-container">
        {% if weekend_deals %}
        <!-- Countdown Timer -->
        <div class="countdown" id="deal-countdown">
          <div><span id="countdown-days">0</span><p>Ngày</p></div>
          <div><span id="countdown-hours">0</span><p>Giờ</p></div>
          <div><span id="countdown-mins">0</span><p>Phút</p></div>
          <div><span id="countdown-secs">0</span><p>Giây</p></div>
        </div>
        
        <!-- Deals Slider -->
        <div class="deals-slider">
          {% for deal in weekend_deals %}
          <div class="deal-item {% if forloop.first %}active{% endif %}" 
               data-end-time="{{ deal.end_time|date:'c' }}"
               data-deal-id="{{ deal.id }}">
            <div class="deal-left">
              <p class="sub-title">{{ deal.title }}</p>
              <h2 class="product-title">{{ deal.product.name }}</h2>
              <p class="product-desc">{{ deal.description|default:deal.product.description|truncatewords:15 }}</p>
              <div class="deal-prices">
                <p class="product-price">{{ deal.deal_price|vnd }}</p>
                {% if deal.discount_percent > 0 %}
                <p class="original-price">{{ deal.product.price|vnd }}</p>
                <span class="discount-badge">-{{ deal.discount_percent }}%</span>
                {% endif %}
              </div>
              {% if deal.max_quantity > 0 %}
              <div class="deal-stock">
                <div class="stock-bar">
                  <div class="stock-fill" style="width: {% widthratio deal.sold_quantity deal.max_quantity 100 %}%"></div>
                </div>
                <span class="stock-text">Đã bán {{ deal.sold_quantity }}/{{ deal.max_quantity }}</span>
              </div>
              {% endif %}
              <a href="{% url 'product_detail' deal.product.id %}" class="shop-now">MUA NGAY <span class="arrow">→</span></a>
            </div>
            <div class="deal-right">
              <img src="{% if deal.deal_image %}{{ deal.deal_image.url }}{% elif deal.product.image %}{{ deal.product.image.url }}{% else %}https://via.placeholder.com/190x243{% endif %}" 
                   alt="{{ deal.product.name }}" />
            </div>
          </div>
          {% endfor %}
        </div>
        
        <!-- Navigation Dots -->
        {% if weekend_deals|length > 1 %}
        <div class="deal-dots">
          {% for deal in weekend_deals %}
          <span class="dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.counter0 }}"></span>
          {% endfor %}
        </div>
        {% endif %}
        
        <!-- Navigation Arrows -->
        {% if weekend_deals|length > 1 %}
        <button class="deal-btn prev-btn">❮</button>
        <button class="deal-btn next-btn">❯</button>
        {% endif %}
        
        {% else %}
        <!-- No deals - hiển thị mặc định -->
        <div class="no-deals">
          <div class="countdown">
            <div><span>0</span><p>Ngày</p></div>
            <div><span>0</span><p>Giờ</p></div>
            <div><span>0</span><p>Phút</p></div>
            <div><span>0</span><p>Giây</p></div>
          </div>
          <div class="deal-item active">
            <div class="deal-left">
              <p class="sub-title">Sắp có deal hot</p>
              <h2 class="product-title">Chờ đón ưu đãi cuối tuần!</h2>
              <p class="product-desc">Đăng ký nhận thông báo để không bỏ lỡ các deal hấp dẫn...</p>
              <a href="{% url 'shop' %}" class="shop-now">XEM SẢN PHẨM <span class="arrow">→</span></a>
            </div>
            <div class="deal-right">
              <img src="https://mint07.com/wp-content/uploads/2024/06/son-tint-carslan-lip-glow-serum-45g-2-190x243.jpg" alt="Coming Soon" />
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </section>

    <section id="top-trending">
      <div class="container">
        <div class="section-header">
          <h2>Xu hướng</h2>
          <div class="header-icons">
            <button class="home-icon"><i class="fas fa-fire"></i></button>
          </div>
        </div>

        <div class="offers-carousel">
          <button class="arrow prev" onclick="scrollCarousel('trending_list', -1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="arrow next" onclick="scrollCarousel('trending_list', 1)">
            <i class="fas fa-chevron-right"></i>
          </button>

          <div class="carousel-container" id="trending_list">
            {% for product in trending_products %}
            <div class="product-card">
              <div class="product-card__image">
                <a href="{% url 'product_detail' product.id %}">
                  <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/190x243{% endif %}"
                       alt="{{ product.name }}" loading="lazy" />
                </a>
                {% if product.active_deal %}
                <span class="product-card__badge deal">-{{ product.active_deal.discount_percent }}%</span>
                {% elif product.sale_price > 0 %}
                <span class="product-card__badge sale">Sale</span>
                {% endif %}
                <div class="product-card__overlay">
                  <div class="product-card__actions">
                    <button onclick="toggleWishlist(event, {{ product.id }})" class="action-btn {% if product.id in wishlist_product_ids %}wishlisted{% endif %}" title="Yêu thích">
                      <i class="{% if product.id in wishlist_product_ids %}fas{% else %}far{% endif %} fa-heart"></i>
                    </button>
                    <a href="{% url 'product_detail' product.id %}" class="action-btn" title="Xem chi tiết">
                      <i class="far fa-eye"></i>
                    </a>
                    <button onclick="addToCartAjax(event, {{ product.id }})" class="action-btn" title="Thêm vào giỏ">
                      <i class="fas fa-shopping-basket"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="product-card__info">
                <span class="product-card__category">{{ product.category.name }}</span>
                <h3 class="product-card__name"><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></h3>
                <div class="product-card__rating">
                  <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                  <span>({{ product.review_set.count|default:0 }})</span>
                </div>
                <div class="product-card__price">
                  {% if product.active_deal %}
                  <span class="price-current deal">{{ product.active_deal.deal_price|vnd }}</span>
                  <span class="price-original">{{ product.price|vnd }}</span>
                  {% elif product.sale_price > 0 %}
                  <span class="price-current">{{ product.sale_price|vnd }}</span>
                  <span class="price-original">{{ product.price|vnd }}</span>
                  {% else %}
                  <span class="price-current">{{ product.price|vnd }}</span>
                  {% endif %}
                </div>
                <button onclick="addToCartAjax(event, {{ product.id }})" class="product-card__add-btn">
                  <i class="fas fa-cart-plus"></i> Thêm vào giỏ
                </button>
              </div>
            </div>
            {% empty %}
                <p>Chưa có sản phẩm xu hướng.</p>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

  </section>
</section>

<section class="blog">
  <div class="blog__container">
    <span class="blog__subtitle">Tin mới nhất</span>
    <h2 class="blog__title">Bài viết</h2>
    <div class="blog__grid">
      <div class="blog__item">
        <img src="https://i.pinimg.com/1200x/3f/39/62/3f3962f01a632cf46740aa390fd0e3dc.jpg" alt="Blog 1" class="blog__image" />
        <div class="blog__content">
          <div class="blog__meta">
            <span class="blog__author">Đăng bởi Admin</span>
            <span class="blog__date">7/3/2025</span>
          </div>
          <h3 class="blog__post-title">12 loại mỹ phẩm bạn nhất định nên có...</h3>
          <a href="#" class="blog__link">Xem thêm →</a>
        </div>
      </div>
      </div>
  </div>
</section>

<style>
  /* Product Card trong Carousel */
  .carousel-container .product-card {
    flex: 0 0 calc(25% - 15px);
    min-width: calc(25% - 15px);
    margin: 0;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
  }

  .carousel-container .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .carousel-container .product-card__image {
    position: relative;
    overflow: hidden;
    aspect-ratio: 1;
    background: #f8f8f8;
  }

  .carousel-container .product-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .carousel-container .product-card:hover .product-card__image img {
    transform: scale(1.08);
  }

  .carousel-container .product-card__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 1.1rem;
    font-weight: 700;
    color: white;
    z-index: 2;
  }

  .carousel-container .product-card__badge.deal {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  }

  .carousel-container .product-card__badge.sale {
    background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
  }

  .carousel-container .product-card__overlay {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .carousel-container .product-card:hover .product-card__overlay {
    opacity: 1;
  }

  .carousel-container .product-card__actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
    transform: translateX(20px);
    transition: transform 0.3s ease;
  }

  .carousel-container .product-card:hover .product-card__actions {
    transform: translateX(0);
  }

  .carousel-container .product-card__actions .action-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.2rem;
    color: #333;
    transition: all 0.3s ease;
    text-decoration: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .carousel-container .product-card__actions .action-btn:hover {
    background: var(--primary-color);
    color: white;
    transform: scale(1.1);
  }

  .carousel-container .product-card__actions .action-btn.wishlisted {
    background: #e74c3c;
    color: white;
  }

  /* Product Info */
  .carousel-container .product-card__info {
    padding: 15px;
  }

  .carousel-container .product-card__category {
    display: inline-block;
    font-size: 1.1rem;
    color: var(--primary-color);
    background: rgba(231, 76, 60, 0.1);
    padding: 3px 10px;
    border-radius: 12px;
    margin-bottom: 8px;
  }

  .carousel-container .product-card__name {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 8px;
    line-height: 1.4;
    height: 40px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .carousel-container .product-card__name a {
    color: #333;
    text-decoration: none;
    transition: color 0.2s;
  }

  .carousel-container .product-card__name a:hover {
    color: var(--primary-color);
  }

  .carousel-container .product-card__rating {
    display: flex;
    align-items: center;
    gap: 3px;
    margin-bottom: 10px;
    font-size: 1.1rem;
  }

  .carousel-container .product-card__rating i {
    color: #ffc107;
  }

  .carousel-container .product-card__rating span {
    color: #999;
    margin-left: 5px;
    font-size: 1.2rem;
  }

  .carousel-container .product-card__price {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .carousel-container .product-card__price .price-current {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
  }

  .carousel-container .product-card__price .price-current.deal {
    color: #e74c3c;
  }

  .carousel-container .product-card__price .price-original {
    font-size: 1.2rem;
    color: #999;
    text-decoration: line-through;
  }

  .carousel-container .product-card__add-btn {
    width: 100%;
    padding: 10px;
    background: linear-gradient(135deg, var(--primary-color) 0%, #c0392b 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
  }

  .carousel-container .product-card__add-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
  }

  /* Đảm bảo nút bấm hiện đúng vị trí */
  .offers-carousel {
    position: relative;
  }

  @media (max-width: 1200px) {
    .carousel-container .product-card {
      flex: 0 0 calc(33.333% - 15px);
      min-width: calc(33.333% - 15px);
    }
  }

  @media (max-width: 768px) {
    .carousel-container .product-card {
      flex: 0 0 calc(50% - 10px);
      min-width: calc(50% - 10px);
    }
  }

  @media (max-width: 480px) {
    .carousel-container .product-card {
      flex: 0 0 calc(100% - 10px);
      min-width: calc(100% - 10px);
    }
  }
</style>

<script>
  function scrollCarousel(containerId, direction) {
    const container = document.getElementById(containerId);
    if (container) {
      // Tính toán khoảng trượt: (Chiều rộng thẻ + khoảng cách) * 4 thẻ
      const card = container.querySelector('.product-card');
      const cardWidth = card ? card.offsetWidth : 200;
      const gap = 20; // Khoảng cách giữa các thẻ
      const scrollAmount = (cardWidth + gap) * 4; 

      if (direction === 1) {
        container.scrollLeft += scrollAmount;
      } else {
        container.scrollLeft -= scrollAmount;
      }
    }
  }
</script>

{% endblock %}
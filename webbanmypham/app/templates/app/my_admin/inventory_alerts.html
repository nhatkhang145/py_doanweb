{% extends 'app/my_admin/base.html' %}
{% load static %}

{% block title %}Cảnh báo Kho hàng & AI{% endblock %}

{% block extra_css %}
<style>
    /* CSS Cục bộ cho trang Inventory (Đồng bộ style Reviews) */

    /* Thanh tiến trình (Progress Bar) */
    .progress-bar {
        width: 80%;
        height: 6px;
        background: #eee;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 6px;
    }

    .progress-bar .fill {
        height: 100%;
        border-radius: 10px;
        min-width: 15px;
        transition: width 0.3s ease;
    }

    .progress-bar .fill.critical {
        background: var(--danger);
    }

    .progress-bar .fill.warning {
        background: var(--warning);
    }

    /* Thẻ đề xuất AI (Card style) */
    .ai-suggestion {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 6px 12px;
        border-radius: 8px;
        border: 1px solid transparent;
        width: fit-content;
    }

    .ai-suggestion i {
        font-size: 1.2rem;
    }

    .ai-suggestion div {
        display: flex;
        flex-direction: column;
    }

    .ai-suggestion strong {
        font-size: 0.8rem;
        font-weight: 700;
    }

    .ai-suggestion small {
        font-size: 0.7rem;
        opacity: 0.9;
    }

    /* Màu sắc thẻ đề xuất */
    .ai-suggestion.discount {
        background: #fee2e2;
        color: #dc2626;
        border-color: #fecaca;
    }

    .ai-suggestion.discount i {
        color: #dc2626;
    }

    .ai-suggestion.restock {
        background: #fef3c7;
        color: #b45309;
        border-color: #fde68a;
    }

    .ai-suggestion.restock i {
        color: #f59e0b;
    }

    /* Nút hành động nhanh */
    .action-btn {
        border: none;
        cursor: pointer;
    }

    .action-btn.edit {
        background: var(--light-primary);
        color: var(--primary);
    }

    .action-btn.edit:hover {
        background: var(--primary);
        color: var(--light);
    }

    /* Màu sắc cho cột vấn đề */
    .issue-critical {
        font-size: 0.85rem;
        color: #dc2626;
        font-weight: 600;
    }

    .issue-warning {
        font-size: 0.85rem;
        color: #f59e0b;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="header">
    <div class="left">
        <h1>Sức khỏe Kho hàng</h1>
        <ul class="breadcrumb">
            <li><a href="{% url 'admin_dashboard' %}">Admin</a></li>
            <li>/</li>
            <li><a href="#" class="active">Cảnh báo & Đề xuất</a></li>
        </ul>
    </div>
</div>

<ul class="insights">
    <li>
        <i class='bx bx-trending-down'></i>
        <span class="info">
            <h3>{{ total_dead }}</h3>
            <p>Sản phẩm Bán chậm</p>
        </span>
    </li>
    <li>
        <i class='bx bx-error-circle'></i>
        <span class="info">
            <h3>{{ total_low }}</h3>
            <p>Sắp hết hàng</p>
        </span>
    </li>
    
</ul>

<div class="bottom-data">
    <div class="orders">
        <div class="header">
            <h3>Danh sách cần xử lý gấp</h3>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Sản phẩm</th>
                    <th style="width: 20%;">Tình trạng kho</th>
                    <th>Vấn đề phát hiện</th>
                    <th>AI Đề xuất hành động</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                {% for item in alerts %}
                <tr>
                    <td>
                        <div class="product-info" style="display: flex; align-items: center; gap: 12px;">
                            <img src="{{ item.product.image.url }}" alt="Product"
                                style="width: 48px; height: 48px; border-radius: 8px; object-fit: cover; border: 1px solid var(--grey);">
                            <div>
                                <p style="font-weight: 600; color: var(--dark); margin-bottom: 2px;">
                                    {{ item.product.name }}
                                </p>
                                <small
                                    style="font-size: 0.75rem; color: var(--dark-grey); background: var(--grey); padding: 2px 6px; border-radius: 4px;">
                                    SKU: #{{ item.product.sku }}
                                </small>
                            </div>
                        </div>
                    </td>

                    <td>
                        <span style="font-weight: 700; color: var(--dark);">Còn: {{ item.product.stock_quantity }} (Max:
                            100)</span>
                        <div class="progress-bar">
                            <div class="fill {% if item.type == 'LOW_STOCK' %}critical{% else %}warning{% endif %}"
                                style="width: {{ item.product.stock_quantity }} %;">
                            </div>
                        </div>
                    </td>

                    <td>
                        <small
                            class="{% if item.type == 'LOW_STOCK' %}issue-critical{% else %}issue-warning{% endif %}">
                            {{ item.message }}
                        </small>
                    </td>

                    <td>
                        <div class="ai-suggestion {{ item.css_class }}">
                            <i class='bx {{ item.icon }}'></i>
                            <div>
                                <strong>{{ item.suggestion }}</strong>
                                <small>Tối ưu dòng tiền</small>
                            </div>
                        </div>
                    </td>

                    <td class="action-cell">
                        <a href="{% url 'admin_product_edit' item.product.id %}" class="action-btn edit"
                            title="Điều chỉnh ngay"
                            style="display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 8px;">
                            <i class='bx bx-edit-alt'></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 30px; color: var(--dark-grey);">
                        <i class='bx bx-check-double'
                            style="font-size: 3rem; color: var(--success); margin-bottom: 10px;"></i><br>
                        Tuyệt vời! Kho hàng đang được tối ưu.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
{% extends 'app/my_admin/base.html' %}
{% load static %}

{% block title %}Qu·∫£n l√Ω ƒê√°nh gi√° & AI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/admin/reviews.css' %}" />
{% endblock %}

{% block search_placeholder %}T√¨m n·ªôi dung, t√™n kh√°ch h√†ng...{% endblock %}

{% block content %}
<div class="header">
    <div class="left">
        <h1>ƒê√°nh gi√° & Ph√¢n t√≠ch AI</h1>
        <ul class="breadcrumb">
            <li><a href="{% url 'admin_dashboard' %}">Qu·∫£n l√Ω</a></li>
            <li>/</li>
            <li><a href="#" class="active">ƒê√°nh gi√°</a></li>
        </ul>
    </div>
</div>

<ul class="insights">
    <li>
        <i class='bx bx-smile'></i>
        <span class="info">
            <h3>{{ pos_percent }}%</h3>
            <p>Ph·∫£n h·ªìi T√≠ch c·ª±c</p>
        </span>
    </li>
    <li>
        <i class='bx bx-angry'></i>
        <span class="info">
            <h3>{{ neg_percent }}%</h3>
            <p>Ph·∫£n h·ªìi Ti√™u c·ª±c</p>
        </span>
    </li>
    <li>
        <i class='bx bx-star'></i>
        <span class="info">
            <h3>{{ avg_rating }}/5</h3>
            <p>ƒêi·ªÉm trung b√¨nh</p>
        </span>
    </li>
    <li>
        <i class='bx bx-message-square-dots'></i>
        <span class="info">
            <h3>{{ total_reviews }}</h3>
            <p>T·ªïng ƒë√°nh gi√°</p>
        </span>
    </li>
    <li>
        <i class='bx bx-spam'></i>
        <span class="info">
            <h3>{{ spam_count }}</h3>
            <p>Comment Spam</p>
        </span>
    </li>
</ul>

<div class="bottom-data">
    <div class="orders">
        <div class="header">
            <h3>Danh s√°ch ƒë√°nh gi√°</h3>

            <div class="filters">
                <select>
                    <option value="">T·∫•t c·∫£ c·∫£m x√∫c</option>
                    <option value="POS"> T√≠ch c·ª±c (Positive)</option>
                    <option value="NEG"> Ti√™u c·ª±c (Negative)</option>
                    <option value="NEU"> Trung t√≠nh (Neutral)</option>
                </select>
                <select>
                    <option value="">S·ªë sao</option>
                    <option value="5">5 Sao</option>
                    <option value="1">1 Sao</option>
                </select>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 180px;">S·∫£n ph·∫©m</th>
                    <th>Kh√°ch h√†ng</th>
                    <th style="width: 100px;">ƒê√°nh gi√°</th>
                    <th>N·ªôi dung b√¨nh lu·∫≠n</th>
                    <th style="width: 150px;">AI Ph√¢n t√≠ch</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                {% for review in reviews %}
                <tr>
                    <td>
                        <div class="product-info">
                            <img src="{{ review.product.image.url }}" alt="Product">
                            <div>
                                <p>{{ review.product.name }}</p>
                                <small>#{{ review.product.sku }}</small>
                            </div>
                        </div>
                    </td>

                    <td>
                        <div class="user-info">
                            <img src="{{ review.customer.avatar.url|default:'/static/img/default.png' }}" alt="User">
                            <div>
                                <p>{{ review.customer.user.username }}</p>
                                <small>Customer</small>
                            </div>
                        </div>
                    </td>

                    <td>
                        <div class="stars">
                            {% for i in "12345" %}
                            {% if forloop.counter <= review.rating %} <i class='bx bxs-star'></i>
                                {% else %}
                                <i class='bx bx-star'></i>
                                {% endif %}
                                {% endfor %}
                        </div>
                    </td>

                    <td>
                        <div class="comment-wrapper">
                            <div class="comment-text">"{{ review.comment }}"</div>
                            <span class="comment-date">{{ review.created_at|date:"d/m/Y" }}</span>
                        </div>
                    </td>

                    <td>
                        {% if review.is_spam %}
                        <div class="ai-badge spam" title="{{ review.spam_reason }}">
                            <span>üö® SPAM</span>
                            <span class="confidence">{{ review.spam_reason }}</span>
                        </div>
                        {% elif review.sentiment == 'POS' %}
                        <div class="ai-badge positive">
                            <span>T√≠ch c·ª±c</span>
                            <span class="confidence">{{ review.confidence_score }}%</span>
                        </div>
                        {% elif review.sentiment == 'NEG' %}
                        <div class="ai-badge negative">
                            <span>Ti√™u c·ª±c</span>
                            <span class="confidence">{{ review.confidence_score }}%</span>
                        </div>
                        {% else %}
                        <div class="ai-badge neutral">
                            <span>Trung t√≠nh</span>
                            <span class="confidence">{{ review.confidence_score }}%</span>
                        </div>
                        {% endif %}
                    </td>

                    <td>
                        {% if review.is_approved %}
                        <div class="status active">Hi·ªÉn th·ªã</div>
                        {% else %}
                        <div class="status banned">ƒêang ·∫©n</div>
                        {% endif %}
                    </td>

                    <td class="action-cell">
                        <a href="#" class="action-btn reply" title="Tr·∫£ l·ªùi">
                            <i class='bx bx-reply'></i>
                        </a>
                        {% if review.is_spam %}
                        <a href="#" class="action-btn delete" title="X√≥a spam">
                            <i class='bx bx-trash'></i>
                        </a>
                        {% elif review.is_approved %}
                        <a href="#" class="action-btn lock" title="·∫®n">
                            <i class='bx bx-hide'></i>
                        </a>
                        {% else %}
                        <a href="#" class="action-btn unlock" title="Duy·ªát">
                            <i class='bx bx-check'></i>
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="pagination">
        <a href="#" class="page-btn disabled">&laquo;</a>
        <a href="#" class="page-btn active">1</a>
        <a href="#" class="page-btn">2</a>
        <a href="#" class="page-btn">&raquo;</a>
    </div>
</div>
{% endblock %}